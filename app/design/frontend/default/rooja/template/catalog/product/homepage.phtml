<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>

<?php 
$i = 0;
$categories = Mage::helper('catalog/category')->getStoreCategories();
foreach ($categories as $_category){
    if($_category->hasChildren()){
        $_category->getId(); // category id
        foreach($_category->getChildren() as $subcategory){
		$c = Mage::getModel('catalog/category')->load($subcategory->getId());
            if($c->getIsActive()){ // check if category is active
				$fivedays = date('y-m-d H:G:00', strtotime("+5 days"));
				$today = date('y-m-d H:G:00');
				if (!$c->getSale_start_date() == null) {
	                $startdate = date('y-m-d', strtotime($c->getSale_start_date())) . ' ' . $c->getSale_start_time() . ':00';
					$enddate = date('y-m-d', strtotime($c->getSale_end_date())) . ' ' . $c->getSale_end_time() . ':00';
					if (($enddate > $today && $enddate < $fivedays && $startdate < $fivedays) || ($enddate > $today && $enddate > $fivedays && $startdate < $fivedays)) {
						if($i == 3){
							?>
							<article class="homeAd fl masonry">
								<h3><a href="/rewardsref/customer/index/">Invite a Friend</a></h3>
								<p>Share what&rsquo;s in with your friends on Facebook! Invite a friend and receive $25 to spend on Rooja!</p>
							</article>
							<article class="homeSale size3 fl masonry">
				                <a href="<?php echo  $c->getURL() ?>" title="View sale details for: <?php echo $c->getName(); ?>" class="product-image"><img src="/media/catalog/category/<?php echo $c->getThumbnail(); ?>" alt="" width="236px" /></a>
				                <h2><?php echo $c->getName(); ?></h2>
								<?php echo '<p>'. date('M jS \a\t g:ia', strtotime($enddate)) .'</p>';?>
				            </article>
						<?php } else{ ?>
             
             <article class="homeSale size2 fl masonry">
                <a href="<?php echo  $c->getURL() ?>" title="View sale details for: <?php echo $c->getName(); ?>" class="product-image"><img src="/media/catalog/category/<?php echo $c->getThumbnail(); ?>" alt="" width="236px" /></a>
                <h2><?php echo $c->getName(); ?></h2>
            </article>
				<?php } $i++; }}}}  }} ?>
			

<?php
    /* $_productCollection=$this->getLoadedProductCollection();
			$_productCollection = Mage::getResourceModel('catalog/product_collection');
            Mage::getModel('catalog/layer')->prepareProductCollection($_productCollection);
            $_productCollection->getSelect()->order('rand()');
            $_productCollection->addStoreFilter();
            
$_productCollection->addCategoryFilter(Mage::getModel('catalog/category');

            $numProducts = $this->getNumProducts() ? $this->getNumProducts() : 7;
            $_productCollection->setPage(1, $numProducts)->load();
            //var_export($_productCollection);
    $_helper = $this->helper('catalog/output');
    $cards = array('size1','size2','size3'); 
?>


<?php
$sorted = array();
    //$_productCollection=$this->getLoadedProductCollection();
$_productCollection = Mage::getModel('catalog/product')
->getCollection()
->addAttributeToSort()
->addAttributeToSelect('small_image')
->addCategoryFilter(Mage::getModel('catalog/category')->load());
$_productCollection->getSelect()->order(new Zend_Db_Expr('RAND()'));
$numProducts = $this->getNumProducts() ? $this->getNumProducts() : 20;
            $_productCollection->setPage(1, $numProducts)->load();
            $sorted[] = array(
            
            );
            //var_export($_productCollection);
            //die('1');
    $_helper = $this->helper('catalog/output');
    $cards = array('size1','size2','size3');
?>


<?php if(!$_productCollection->count()): ?>
<?php else: ?>
    <?php $_collectionSize = $_productCollection->count() ?>
    <?php foreach ($_productCollection as $_product): ?>
    <?php $category = array();
        $cat_ids = $_product->getCategoryIds();
        $cat = new Mage_Catalog_Model_Category();
        foreach ($cat_ids as $cid)
        {
            $cat->load($cid);
            $cat_data = $cat->_data;
            $category[] = array(
                'name' => $cat_data['name'],
                'url_key' => $cat_data['url_key'],
                'url_path' => $cat_data['url_path'],
                'parent_id' => $cat_data['parent_id'],
				'my_meta' => $cat_data['my_meta']
                );
        }
		//var_dump($cat_data);
        ?>
            <article class="homeSale size2 fl masonry">
                <a href="
                <?php if ($cat_data['parent_id'] == '3') { echo '/women/'; }
                elseif ($cat_data['parent_id'] == '4') { echo '/men/'; }
                elseif ($cat_data['parent_id'] == '5') { echo '/travel/'; }
                echo $cat_data['url_key'] . '.html'; ?>
                " title="View sale details for: <?php echo $cat_data['name']; ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image'); ?>" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" width="236px" /></a>
                <h2><?php echo $cat_data['name']; ?></h2>
            </article>

        <?php endforeach ?>
		<article class="homeAd fl masonry">
			<h3><a href="#">Invite a Friend</a></h3>
			<p>Share what&rsquo;s in with your friends on Facebook! Invite a friend and receive $25 to spend on Rooja!</p>
		</article>		

<?php endif; */ ?>

