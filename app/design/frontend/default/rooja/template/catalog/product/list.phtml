
<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
<?php
    $_productCollection=$this->addAttribute('rl_price')->getLoadedProductCollection();
    $_helper = $this->helper('catalog/output');
	$boutique = 0;
	$parentCat = Mage::getBlockSingleton('catalog/navigation')->getCurrentCategory()->parent_id;
	if($parentCat==5){$boutique = 1;}
?> 
<?php if(!$_productCollection->count()): ?>
<section id="saleProducts" class="col3 fl">

<p class="note-msg"><?php echo $this->__('There are no products matching the selection.') ?></p>
</section>
<?php else: ?>
<section id="saleProducts" class="col3 fl<?php if($boutique==1){echo ' boutiqueSale';}?>">
    <?php $i=1; foreach ($_productCollection as $_product): ?>
	<?php $fbprice = $_helper->productAttribute($_product, $_product->getRl_price(), 'rl_price'); ?>
	<?php //echo $fbprice; ?>
	<?php //var_export($_product); ?>
		<article class="product col1 fl <?php if ($i % 3 == 0){ echo 'noMargin'; } ?>">
		<?php $stock_count = (int) Mage::getModel('cataloginventory/stock_item')->loadByProduct($_product)->getQty();
if ($stock_count <= 5 && $stock_count > 0) {
echo '<span class="numLeft">'.$stock_count.'</span>';
} ?>
			
			<a href="<?php echo $_product->getProductUrl() ?>"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image'); ?>" width="230" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" /></a>
			<article class="productCore<?php if(!$_product->isSaleable()){ echo ' soldOut'; } ?>">
				<?php if($boutique==0){ ?><span class="numLikes">
				
				<?php $source_url = $_product->getProductUrl();
$url = "http://api.facebook.com/restserver.php?method=links.getStats&urls=".urlencode($source_url);
$xml = file_get_contents($url);
$xml = simplexml_load_string($xml);
echo $likes = $xml->link_stat->like_count;
?>
				
				</span><?php } ?>
				<p class="price"><span class="livePrice">
				<?php if (!$fbprice == null) { ?>
					<?php echo 'Rs. ' . number_format($fbprice, 2); } else { ?>
					<?php echo 'Rs. ' . number_format($_product->getSpecialprice(), 2); } ?>
				
				</span><span> 
				<?php if(!$_product->isSaleable()){ echo 'Sold Out'; } elseif($boutique==0) { echo 'Rs. ' . number_format($_product->getPrice(), 2); } ?></span></p>
				<h2 class="productName"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h2>
			</article>
		</article>
		<?php $i++; ?>
        <?php endforeach ?>
</section>

<script type="text/javascript">
	jQuery(document).ready(function(){
		jQuery(".product").hover(function () {
		    jQuery(this).find('.productName').fadeIn(500);
		  }, 
		  function () {
		    jQuery(this).find('.productName').fadeOut(500);
		 
		  });
	 });
			
</script>
<?php endif; ?>
