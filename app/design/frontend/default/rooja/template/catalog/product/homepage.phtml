<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
</p></div>
<?php
function timeBetweenNowAndDeadline($deadline) {
    $deadline = strtotime($deadline);
	$currentDate = date("U");
    $diff = $deadline-$currentDate;
    $seconds = 0;
    $hours   = 0;
    $minutes = 0;

    if($diff % 86400 <= 0){$days = $diff / 86400;}  // 86,400 seconds in a day
    if($diff % 86400 > 0)
    {
        $rest = ($diff % 86400);
        $days = ($diff - $rest) / 86400;
        if($rest % 3600 > 0)
        {
            $rest1 = ($rest % 3600);
            $hours = ($rest - $rest1) / 3600;
            if($rest1 % 60 > 0)
            {
                $rest2 = ($rest1 % 60);
            $minutes = ($rest1 - $rest2) / 60;
            $seconds = $rest2;
            }
            else{$minutes = $rest1 / 60;}
        }
        else{$hours = $rest / 3600;}
    }

    if($days > 0){$days = $days.' days';}
    else{$days = false;}
    if($hours > 0){
		if($days!=false){
			$hours = ' and '.$hours.' hours ';
		}
		else{
			$hours = $hours.' hours ';
		}
	}
    else{$hours = false;}
    if($minutes > 0){$minutes = $minutes.' minutes';}
    else{$minutes = false;}
    $seconds = $seconds.'s'; // always be at least one second
	
	if($days==0 && $hours == 0 && $minutes == 0){
		return 0;
	}
	elseif($days==0 && $hours == 0){
		return $minutes;
	}
	else{
		return $days.''.$hours;	
	}
    
}

?>
<?php 
$i = 0;
$categories = Mage::helper('catalog/category')->getStoreCategories();
foreach ($categories as $_category){
    if($_category->hasChildren()){
        $_category->getId(); // category id
		if($_category->getId() !=5){
        foreach($_category->getChildren() as $subcategory){
		$c = Mage::getModel('catalog/category')->load($subcategory->getId());
            if($c->getIsActive()){ // check if category is active
				$fivedays = strtotime(date('y-m-d H:G:00', strtotime("+2 days")));
				$today = strtotime(date('y-m-d H:i:s'));
				if (!$c->getSale_start_date() == null) {
	                $startdate = strtotime(date('y-m-d', strtotime($c->getSale_start_date())) . ' ' . $c->getSale_start_time() . ':00');
					$enddate = strtotime(date('y-m-d', strtotime($c->getSale_end_date())) . ' ' . $c->getSale_end_time() . ':00');
					//if(timeBetweenNowAndDeadline($enddate) != 0){
					if (($enddate > $today && $enddate < $fivedays && $startdate < $today) || ($enddate > $today && $enddate > $fivedays && $startdate < $today)) {
						if($i == 3){
							?>
							<article class="homeAd2 fl masonry">
								<a href="/rewardsref/customer/index/"><img src="<?php echo $this->getSkinUrl('images/graphics/spreadthelove3.jpg'); ?>" alt="Invite Friends and get cash" /></a>
							</article>
							<article class="homeSale size2 fl masonry">
				                <a href="<?php echo  $c->getURL() ?>" title="View sale details for: <?php echo $c->getName(); ?>" class="product-image"><img src="/media/catalog/category/<?php echo $c->getThumbnail(); ?>" alt="" width="236px" /></a>
				                <h2 class='blackBg'><?php echo $c->getName(); ?></h2>
						
								<p>Sale ends in <?php echo timeBetweenNowAndDeadline($enddate); ?></p>
				            </article>
						<?php } else{ ?>
             
             <article class="homeSale size2 fl masonry">
                <a href="<?php echo  $c->getURL() ?>" title="View sale details for: <?php echo $c->getName(); ?>" class="product-image"><img src="/media/catalog/category/<?php echo $c->getThumbnail(); ?>" alt="" width="236px" /></a>
                <h2<?php if($i%2==1) echo " class='blackBg'"; ?>><?php echo $c->getName(); ?></h2>
				<p>Sale ends in <?php echo timeBetweenNowAndDeadline($enddate); ?></p>
            </article>
				<?php } $i++; }}}}}}  } ?>			


<script type="text/javascript">
	jQuery(document).ready(function(){
		jQuery(".homeSale p").hide();
		jQuery(".homeSale").hover(function () {
		    jQuery(this).find('p').fadeIn(500);
		  }, 
		  function () {
		    jQuery(this).find('p').fadeOut(500);
		  });
	 });
			
</script>
<div><p>