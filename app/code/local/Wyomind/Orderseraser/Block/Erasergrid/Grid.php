<?phpclass Wyomind_Orderseraser_Block_Erasergrid_Grid extends Mage_Adminhtml_Block_Widget_Grid{    public function __construct()    {           	parent::__construct();		        $this->setId('sales_order_grid');        $this->setUseAjax(true);        $this->setDefaultSort('created_at');        $this->setDefaultDir('DESC');        $this->setSaveParametersInSession(true);    }    /**     * Retrieve collection class     *     * @return string     */   public function getVersion(){   		return  substr(Mage::getVersion(),0,3);   }   	 protected function _prepareCollection()    {       	  	   if($this->getVersion()<=1.3){			$collection = Mage::getResourceModel('sales/order_collection')				->addAttributeToSelect('*')				->joinAttribute('billing_firstname', 'order_address/firstname', 'billing_address_id', null, 'left')				->joinAttribute('billing_lastname', 'order_address/lastname', 'billing_address_id', null, 'left')				->joinAttribute('shipping_firstname', 'order_address/firstname', 'shipping_address_id', null, 'left')				->joinAttribute('shipping_lastname', 'order_address/lastname', 'shipping_address_id', null, 'left')				->addExpressionAttributeToSelect('billing_name',					'CONCAT({{billing_firstname}}, " ", {{billing_lastname}})',					array('billing_firstname', 'billing_lastname'))				->addExpressionAttributeToSelect('shipping_name',					'CONCAT({{shipping_firstname}}, " ", {{shipping_lastname}})',					array('shipping_firstname', 'shipping_lastname'));		}		else $collection = Mage::getResourceModel($this->_getCollectionClass());		$this->setCollection($collection);		return parent::_prepareCollection();    }		protected function _getCollectionClass()    {        return 'sales/order_grid_collection';    }    	protected function _prepareColumns()    {        $this->addColumn('real_order_id', array(            'header'=> Mage::helper('sales')->__('Order #'),            'width' => '80px',            'type'  => 'text',            'index' => 'increment_id',        ));        if (!Mage::app()->isSingleStoreMode()) {            $this->addColumn('store_id', array(                'header'    => Mage::helper('sales')->__('Purchased From (Store)'),                'index'     => 'store_id',                'type'      => 'store',                'store_view'=> true,                'display_deleted' => true,            ));        }        $this->addColumn('created_at', array(            'header' => Mage::helper('sales')->__('Purchased On'),            'index' => 'created_at',            'type' => 'datetime',            'width' => '100px',        ));        $this->addColumn('billing_name', array(            'header' => Mage::helper('sales')->__('Bill to Name'),            'index' => 'billing_name',        ));        $this->addColumn('shipping_name', array(            'header' => Mage::helper('sales')->__('Ship to Name'),            'index' => 'shipping_name',        ));        $this->addColumn('base_grand_total', array(            'header' => Mage::helper('sales')->__('G.T. (Base)'),            'index' => 'base_grand_total',            'type'  => 'currency',            'currency' => 'base_currency_code',        ));        $this->addColumn('grand_total', array(            'header' => Mage::helper('sales')->__('G.T. (Purchased)'),            'index' => 'grand_total',            'type'  => 'currency',            'currency' => 'order_currency_code',        ));        $this->addColumn('status', array(            'header' => Mage::helper('sales')->__('Status'),            'index' => 'status',            'type'  => 'options',            'width' => '70px',            'options' => Mage::getSingleton('sales/order_config')->getStatuses(),        ));        if (Mage::getSingleton('admin/session')->isAllowed('sales/order/actions/delete')) {            $this->addColumn('action',                array(                    'header'    => Mage::helper('sales')->__('Action'),                    'width'     => '50px',                    'type'      => 'action',                    'getter'     => 'getId',                    'actions'   => array(                      						array(                            'caption' => Mage::helper('sales')->__('Delete'),                            'url'     => array('base'=>'orderseraser/adminhtml_orderseraser/delete/eraser/1'),							'confirm' => Mage::helper('sales')->__('Are your sure your want to delete this order and to erase all linked data ? '),                         	'field'   => 'order_id'                        )                    ),                    'filter'    => false,                    'sortable'  => false,                    'index'     => 'stores',                    'is_system' => true,            ));        }               return parent::_prepareColumns();    }    protected function _prepareMassaction()    {        $this->setMassactionIdField('entity_id');        $this->getMassactionBlock()->setFormFieldName('order_ids');              $this->getMassactionBlock()->setUseSelectAll(false);          if (Mage::getSingleton('admin/session')->isAllowed('sales/order/actions/delete')) {	          	$this->getMassactionBlock()->addItem('delete_order', array(	             'label'=> Mage::helper('sales')->__('Delete'),	             'url'  => $this->getUrl('orderseraser/adminhtml_orderseraser/massdelete',array('eraser' => 1)),	        ));                  }			        return $this;    } }