<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
</p></div>

<?php 
$i = 0;
$categories = Mage::helper('catalog/category')->getStoreCategories(); 
$first_index = 0;
$second_index = 0;

foreach ($categories as $_category) 
{ 
    if($_category->hasChildren())
	{
        $_category->getId(); // category id  
		if($_category->getId() !=5)
		{  
						
        foreach($_category->getChildren() as $subcategory)
		{ 
		
			$c = Mage::getModel('catalog/category')->load($subcategory->getId()); 
			
			$product_parent_id = $c['parent_id'];
			
			//code for current user gender get
			$session = Mage::getSingleton('customer/session'); 
			$customer = $session->getCustomer();
			if($customer['gender']=='1')
			{
				$gender='1';
				$category_id='4';
			}
			else if($customer['gender']=='2')
			{
				$gender='2';
				$category_id='58';
			}
			else
			{
				$gender='2';
				$category_id='58';
			}
		

            if($c->getIsActive()) 
			{ // check if category is active 
			
			
				$fivedays = strtotime(date('y-m-d H:G:00', strtotime("+2 days")));
				$today = strtotime(date('y-m-d H:i:s'));
				if (!$c->getSale_start_date() == null) 
				{
	                $startdate = strtotime(date('y-m-d', strtotime($c->getSale_start_date())) . ' ' . $c->getSale_start_time() . ':00');
					$enddate = strtotime(date('y-m-d', strtotime($c->getSale_end_date())) . ' ' . $c->getSale_end_time() . ':00'); 
					
					if(timeBetweenNowAndDeadline($enddate) != 0)
					{
					if (($enddate > $today && $enddate < $fivedays && $startdate < $today) || ($enddate > $today && $enddate > $fivedays && $startdate < $today)) 
					{  
			
					//Filter the data's gender wise with category
				 	if($customer['gender']==$gender && $product_parent_id==$category_id)
					{  
						 $first_catogory[$first_index]='<article class="homeSale size2 fl masonry">
						 <a href="'.$c->getURL().'" title="View sale details for:'.$c->getName().'" class="product-image"><img src="/media/catalog/category/'.$c->getThumbnail().'" alt="" width="236px" /></a>
						<h2';
								   if($i%2==1)
								   {
										 $first_catogory[$first_index] = $first_catogory[$first_index].' class="blackBg"';
								   }
				   $first_catogory[$first_index] = $first_catogory[$first_index].'>'.$c->getName().'</h2><p>Sale ends in '.timeBetweenNowAndDeadline($enddate).'</p></article>'; 
		
							 $i++;
							 $first_index++; 
							
				}   //gender filter if condition end
				else
				{ 
				   $another_catogory[$second_index]='<article class="homeSale size2 fl masonry">
						<a href="'.$c->getURL().'" title="View sale details for:'.$c->getName().'" class="product-image"><img src="/media/catalog/category/'.$c->getThumbnail().'" alt="" width="236px" /></a>
						<h2';
								   if($i%2==1)
								   {
										 $another_catogory[$second_index] = $another_catogory[$second_index].' class="blackBg"';
								   }
								   
				   $another_catogory[$second_index] = $another_catogory[$second_index].'>'.$c->getName().'</h2><p>Sale ends in '.timeBetweenNowAndDeadline($enddate).'</p></article>';
		
						 $i++;
						 $second_index++; 
				}   //gender filter else condition end 
				
				}
			  }
			  }
			  }
		}
	}
} 
}

            // Printing Home Top sales Colletion for men and women vice versa.			
			$count = 0;
			$first_collection = $first_catogory;	 
			
			$love_sym = $this->getSkinUrl('images/graphics/spreadthelove3.jpg');
			$love_categoty ='<article class="homeAd2 fl masonry"><a href="/rewardsref/customer/index/"><img src="'.$love_sym.'" alt="Invite Friends and get cash" /></a></article>';
								
			//printing  first colletion for loged in gender
			foreach($first_collection as $colletion)
			{ 
			 echo $colletion;
			 $count++;
				 if($count == 3)
				 { 
				  // printing invite friend box
				  echo $love_categoty;
				 }
			}

			//print the home page top colletion for oppsite gender colletion
			$another_colletions = $another_catogory; 
		    $count_one = count($another_catogory);
			foreach($another_colletions as $var)
			{
			echo $var;
			$count++;
				 if($count == 3)
				 { 
				  // printing invite friend box
				  echo $love_categoty;
				 }
			}
?>

<script type="text/javascript">
	jQuery(document).ready(function(){
		jQuery(".homeSale p").hide();
		jQuery(".homeSale").hover(function () {
		    jQuery(this).find('p').fadeIn(500);
		  }, 
		  function () {
		    jQuery(this).find('p').fadeOut(500);
		  });
	 });
			
</script>
<div><p>